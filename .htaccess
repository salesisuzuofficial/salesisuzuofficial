# ============================
# ðŸ”’ SECURITY & SEO OPTIMIZED
# ============================

Options -Indexes

RewriteEngine On
RewriteBase /

# ===========================
# FORCE CANONICAL (FINAL)
# ===========================

RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} ^www\.salesisuzuofficial\.com$ [NC]
RewriteRule ^(.*)$ https://salesisuzuofficial.com/$1 [R=301,L]

# Force homepage slash
RewriteCond %{REQUEST_URI} ^/?$ [OR]
RewriteCond %{REQUEST_URI} ^/index\.php$ [NC]
RewriteRule ^ https://salesisuzuofficial.com/ [R=301,L]



# --------------------------
# SEO Friendly URL (detail_artikel)
RewriteCond %{THE_REQUEST} \s/detail_artikel\?slug=([^\s&]+) [NC]
RewriteRule ^detail_artikel$ detail_artikel/%1? [R=301,L]

RewriteRule ^detail_artikel/([^/]+)/?$ detail_artikel.php?slug=$1 [L,QSA]

# --------------------------
# Remove .php extension from URL
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^([^/]+)$ $1.php [L]

RewriteCond %{THE_REQUEST} \s/([^.]+)\.php[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# --------------------------
# Protect sensitive files
<FilesMatch "(^\.|config\.php|koneksi\.php|composer\.json|composer\.lock|package\.json|yarn\.lock|\.env|\.git|\.htpasswd)">
    Require all denied
</FilesMatch>

<FilesMatch "\.(phps|php5|phtml|exe|sh|bat|pl|py|jsp|asp)$">
    Require all denied
</FilesMatch>

<Files ".htaccess">
    Require all denied
</Files>

# --------------------------
# Block suspicious query strings
RewriteCond %{QUERY_STRING} (\.\./|\.\.\\|/etc/passwd|/bin/bash|base64_encode|eval\(|system\(|shell_exec\() [NC]
RewriteRule .* - [F,L]

# --------------------------
# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# --------------------------
# Caching for static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    ExpiresDefault "access plus 3 days"
</IfModule>

<IfModule mod_headers.c>
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# ===========================
# End of config
# ===========================
